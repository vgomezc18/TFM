---
title: "Contraste de métodos de imputación estadística en la documentación de víctimas del
conflicto armado colombiano"
author: "Valentina Gómez^[[valegome@ucm.es](valegome@ucm.es)]"
date: '`r format(Sys.time(), "%d %B %Y")`'
output: pdf_document
site: "bookdown::bookdown_site"
lang: es-CO
fig_width: 4
fig_height: 2.5
fontsize: 12pt
urlcolor: blue
editor_options: 
  markdown: 
    wrap: sentence
---
# Comparación modelos

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


require(pacman)
p_load(here, readr, tidyverse, dplyr, validate, data.table, missForest, 
			 VIM, lattice, simputation, mice, skimr, compareDF)


```

# Importación de datos:

```{r}

imputacion_dir <- here::here("08.modelos_imputacion/output")
documentado_dir <- here::here("01.tablas_documentadas/output")

output_dir <- here::here("09.comparacion_modelos/output")

imputacion_donante_sexo <- readRDS(paste0(imputacion_dir,"/imputacion_donante_sexo.rds")) 
imputacion_regresion_sexo <- readRDS(paste0(imputacion_dir,"/imputacion_regresion_sexo.rds")) 
imputacion_ml_sexo <- readRDS(paste0(imputacion_dir,"/imputacion_ml_sexo.rds")) 

# Función para cargar réplicas
cargar_replicas <- function(nombre_directorio, nombre_archivo, replicas) {
  verdata::read_replicates(here::here(nombre_directorio), nombre_archivo, replicas)
}

# Función para resumir tablas documentadas
resumir_tabla_documentada <- function(nombre_archivo, replicas, strata_vars, conflict_filter = TRUE, edad_minors_filter = FALSE, include_props = TRUE, forced_dis_filter = FALSE) {
	
  verdata::summary_observed(nombre_archivo,
                            replicas, 
                            strata_vars = strata_vars,
                            conflict_filter = conflict_filter,
                            edad_minors_filter = edad_minors_filter,
                            include_props = include_props,
                            forced_dis_filter = forced_dis_filter)
}

# Definir parámetros comunes
strata_vars_comunes <- c("sexo", "yy_hecho")
replicas <- c(1:10)

# Cargar réplicas
replicas_desaparicion <- cargar_replicas("01.tablas_documentadas/input/verdata-parquet/desaparicion", "desaparicion", replicas)

replicas_homicidio <- cargar_replicas("01.tablas_documentadas/input/verdata-parquet/homicidio", "homicidio", replicas)

replicas_secuestro <- cargar_replicas("01.tablas_documentadas/input/verdata-parquet/secuestro", "secuestro", replicas)

replicas_reclutamiento <- cargar_replicas("01.tablas_documentadas/input/verdata-parquet/reclutamiento", "reclutamiento", replicas)

# Crear tablas documentadas
tabla_documentada_desaparicion <- resumir_tabla_documentada("desaparicion", replicas_desaparicion, strata_vars_comunes, forced_dis_filter = TRUE)

tabla_documentada_homicidio <- resumir_tabla_documentada("homicidio", replicas_homicidio, strata_vars_comunes)

tabla_documentada_secuestro <- resumir_tabla_documentada("secuestro", replicas_secuestro, strata_vars_comunes)

tabla_documentada_reclutamiento <- resumir_tabla_documentada("reclutamiento", replicas_reclutamiento, strata_vars_comunes)

```


Inserto los resultados por donante: 

```{r}
donante_sexo_desap <- rbind(imputacion_donante_sexo[["desaparicion_1998_2000"]], 
			imputacion_donante_sexo[["desaparicion_2001_2005"]],
			imputacion_donante_sexo[["desaparicion_2006_2010"]],
			imputacion_donante_sexo[["desaparicion_2011_2016"]])

donante_sexo_homi <- rbind(imputacion_donante_sexo[["homicidio_1998_2000"]], 
			imputacion_donante_sexo[["homicidio_2001_2005"]],
			imputacion_donante_sexo[["homicidio_2006_2010"]],
			imputacion_donante_sexo[["homicidio_2011_2016"]])

donante_sexo_secue <- rbind(imputacion_donante_sexo[["secuestro_1998_2000"]], 
			imputacion_donante_sexo[["secuestro_2001_2005"]],
			imputacion_donante_sexo[["secuestro_2006_2010"]],
			imputacion_donante_sexo[["secuestro_2011_2016"]])

donante_sexo_reclu <- rbind(imputacion_donante_sexo[["reclutamiento_1998_2000"]], 
			imputacion_donante_sexo[["reclutamiento_2001_2005"]],
			imputacion_donante_sexo[["reclutamiento_2006_2010"]],
			imputacion_donante_sexo[["reclutamiento_2011_2016"]])
```

Inserto los resultados por regresión: 

```{r}
regresion_sexo_desap <- as.data.frame(imputacion_regresion_sexo[["desaparicion_1998_2016"]])

regresion_sexo_homi <- as.data.frame(imputacion_regresion_sexo[["homicidio_1998_2016"]])

regresion_sexo_secue <- as.data.frame(imputacion_regresion_sexo[["secuestro_1998_2016"]])

regresion_sexo_reclu <- as.data.frame(imputacion_regresion_sexo[["reclutamiento_1998_2016"]])
```

Inserto los resultados por Random Forest: 

```{r}
ml_sexo_desap <- imputacion_ml_sexo %>%
	filter(violencia == "desaparicion") %>%
	select(sexo, yy_hecho, imp_ml) %>%
	as.data.frame()

ml_sexo_homi <- imputacion_ml_sexo %>%
	filter(violencia == "homicidio") %>%
	select(sexo, yy_hecho, imp_ml) %>%
	as.data.frame()

ml_sexo_secue <- imputacion_ml_sexo %>%
	filter(violencia == "secuestro") %>%
	select(sexo, yy_hecho, imp_ml) %>%
	as.data.frame()

ml_sexo_reclu <- imputacion_ml_sexo %>%
	filter(violencia == "reclutamiento") %>%
	select(sexo, yy_hecho, imp_ml) %>%
	as.data.frame()
```

Inserto los resultados de JEP-CEV-HRDAG:

```{r}

tabla_combinada_desaparicion <- verdata::combine_replicates("desaparicion",
                                                tabla_documentada_desaparicion,
                                                replicas_desaparicion, 
                                                strata_vars = c("sexo", "yy_hecho"),
                                                conflict_filter = TRUE,
                                                forced_dis_filter = TRUE,
                                                edad_minors_filter = FALSE,
                                                include_props = TRUE)

tabla_combinada_desaparicion <- tabla_combinada_desaparicion %>% 
  select(yy_hecho, sexo, observed, obs_prop_na, obs_prop, imp_lo, imp_mean, imp_hi,
         imp_lo_p, imp_mean_p, imp_hi_p ) %>%
	merge(donante_sexo_desap, by = c("sexo", "yy_hecho")) %>%
	merge(regresion_sexo_desap, by = c("sexo", "yy_hecho")) %>%
	merge(ml_sexo_desap, by = c("sexo", "yy_hecho"))

tabla_combinada_homicidio <- verdata::combine_replicates("homicidio",
                                                tabla_documentada_homicidio,
                                                replicas_homicidio, 
                                                strata_vars = c("sexo", "yy_hecho"),
                                                conflict_filter = TRUE,
                                                edad_minors_filter = FALSE,
                                                include_props = TRUE)

tabla_combinada_homicidio <- tabla_combinada_homicidio %>% 
  select(yy_hecho, sexo, observed, obs_prop_na, obs_prop, imp_lo, imp_mean, imp_hi,
         imp_lo_p, imp_mean_p, imp_hi_p ) %>%
	merge(donante_sexo_homi, by = c("sexo", "yy_hecho")) %>%
	merge(regresion_sexo_homi, by = c("sexo", "yy_hecho"))  %>%
	merge(ml_sexo_homi, by = c("sexo", "yy_hecho"))

tabla_combinada_secuestro <- verdata::combine_replicates("secuestro",
                                                tabla_documentada_secuestro,
                                                replicas_secuestro, 
                                                strata_vars = c("sexo", "yy_hecho"),
                                                conflict_filter = TRUE,
                                                edad_minors_filter = FALSE,
                                                include_props = TRUE)

tabla_combinada_secuestro <- tabla_combinada_secuestro %>% 
  select(yy_hecho, sexo, observed, obs_prop_na, obs_prop, imp_lo, imp_mean, imp_hi,
         imp_lo_p, imp_mean_p, imp_hi_p ) %>%
	merge(donante_sexo_secue, by = c("sexo", "yy_hecho")) %>%
	merge(regresion_sexo_secue, by = c("sexo", "yy_hecho"))  %>%
	merge(ml_sexo_secue, by = c("sexo", "yy_hecho"))

tabla_combinada_reclutamiento <- verdata::combine_replicates("reclutamiento",
                                                tabla_documentada_reclutamiento,
                                                replicas_reclutamiento, 
                                                strata_vars = c("sexo", "yy_hecho"),
                                                conflict_filter = TRUE,
                                                edad_minors_filter = FALSE,
                                                include_props = TRUE)

tabla_combinada_reclutamiento <- tabla_combinada_reclutamiento %>% 
  select(yy_hecho, sexo, observed, obs_prop_na, obs_prop, imp_lo, imp_mean, imp_hi,
         imp_lo_p, imp_mean_p, imp_hi_p ) %>%
	merge(donante_sexo_reclu, by = c("sexo", "yy_hecho")) %>%
	merge(regresion_sexo_reclu, by = c("sexo", "yy_hecho"))  %>%
	merge(ml_sexo_reclu, by = c("sexo", "yy_hecho"))

```

# Desaparición - Sexo

## Comparación de resultados

Mujeres:

```{r}
mujeres_proyecto_desap <- tabla_combinada_desaparicion %>%
	  filter(sexo == "MUJER",
	  			 yy_hecho >= 1993) %>%
    mutate(observed = as.numeric(observed)) %>% 
    arrange((yy_hecho))

plot_desap_mujeres_year_imp <- mujeres_proyecto_desap %>%
  mutate(yy_hecho = as.numeric(yy_hecho)) %>% 
  filter(yy_hecho >= 1998) %>%
  ggplot(aes(x = yy_hecho)) +
  geom_line(aes(y = observed, color = "Observado"), size = 1) +
  geom_line(aes(y = imp_mean, color = "Imputado JEP-CEV-HRDAG"), size = 1) +
  geom_line(aes(y = imp_donante, color = "Imputado por Donante"), size = 1) +
  geom_line(aes(y = imp_regresion_log, color = "Imputado por Regresión Log"), size = 1, linetype = "dashed") +
  geom_line(aes(y = imp_ml, color = "Imputado por Random Forest"), size = 1, linetype = "dotted") +
  geom_ribbon(aes(ymin = imp_lo, ymax = imp_hi), fill = "#1F74B1", alpha = 0.2) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 11, angle = 90),
        axis.title.y = element_text(size = 11),
        axis.ticks.x = element_line(size = 0.1),
        legend.position = "bottom",
        legend.box = "horizontal",
        legend.box.margin = margin(0, 0, 10, 0)) +
  scale_x_continuous(breaks = seq(1980, 2016, 2)) +
  scale_y_continuous(breaks = seq(0, max(mujeres_proyecto_desap$imp_hi, na.rm = TRUE), by = 250)) +
  labs(x = "Año",
       y = "Número de víctimas mujeres",
       color = "",
       title = "Desapariciones Forzadas") +
  scale_colour_manual(values = c("Observado" = "#434343",
  															 "Imputado JEP-CEV-HRDAG" = "#1F74B1",
                                 "Imputado por Donante" = "red",
                                 "Imputado por Regresión Log" = "#26C33A",
                                 "Imputado por Random Forest" = "#FFC300")) +
  guides(color = guide_legend(nrow = 2, byrow = TRUE))

plot_desap_mujeres_year_imp

ggsave(paste0(output_dir,"/sexo/plot_desap_mujeres_year_imp.jpg"),
			 plot_desap_mujeres_year_imp, width = 7, height = 7)

```
Hombres:

```{r}
hombres_proyecto_desap <- tabla_combinada_desaparicion %>%
	  filter(sexo == "HOMBRE",
	  			 yy_hecho >= 1993) %>%
    mutate(observed = as.numeric(observed)) %>% 
    arrange((yy_hecho))

plot_desap_hombres_year_imp <- hombres_proyecto_desap %>%
    mutate(yy_hecho = as.numeric(yy_hecho)) %>% 
	  filter(yy_hecho >= 1998) %>%
    ggplot(aes(x = yy_hecho)) +
    geom_line(aes(y = observed, color = "Observado"),  size = 1) +
    geom_line(aes(y = imp_mean,  color = "Imputado JEP-CEV-HRDAG"), size = 1) +
	  geom_line(aes(y = imp_donante,  color = "Imputado por Donante"), size = 1) +
	  geom_line(aes(y = imp_regresion_log,  color = "Imputado por Regresión Log"),
	  					size = 1, linetype = "dashed") +
	  geom_line(aes(y = imp_ml, color = "Imputado por Random Forest"), size = 1, linetype = "dotted") +
	  geom_ribbon(aes(ymin = imp_lo,
                    ymax = imp_hi),
	  						fill = "#1F74B1",
                alpha = 0.2) +
    theme_minimal() +
    theme(axis.text.x = element_text(size = 11, angle = 90),
        axis.title.y = element_text(size = 11),
        axis.ticks.x = element_line(size = 0.1),
        legend.position = "bottom",
        legend.box = "horizontal",
        legend.box.margin = margin(0, 0, 10, 0)) +
    scale_x_continuous(breaks = seq(1980, 2016, 2)) +
		scale_y_continuous(breaks = seq(0, max(hombres_proyecto_desap$imp_hi,
																				 na.rm = TRUE), by = 800)) +
    theme(legend.position = "bottom") +
    labs(x = "Año",
         y = "Número de víctimas hombres",
         color = "",
    		 title = "Desapariciones Forzadas") +
    scale_colour_manual(values = c("Imputado JEP-CEV-HRDAG" = "#1F74B1", 
                               "Observado" = "#434343",
    															 "Imputado por Donante" = "red",
    															 "Imputado por Regresión Log" = "#26C33A",
                                 "Imputado por Random Forest" = "#FFC300"))+ 
	  guides(color = guide_legend(nrow = 2, byrow = TRUE))

plot_desap_hombres_year_imp

ggsave(paste0(output_dir,"/sexo/plot_desap_hombres_year_imp.jpg"),
			 plot_desap_hombres_year_imp, width = 7, height = 7)

```

# Homicidio - Sexo

## Comparación de resultados

Mujeres:

```{r}
mujeres_proyecto_homi <- tabla_combinada_homicidio %>%
	  filter(sexo == "MUJER",
	  			 yy_hecho >= 1993) %>%
    mutate(observed = as.numeric(observed)) %>% 
    arrange((yy_hecho))

plot_homi_mujeres_year_imp <- mujeres_proyecto_homi %>%
    mutate(yy_hecho = as.numeric(yy_hecho)) %>% 
	  filter(yy_hecho >= 1998) %>%
    ggplot(aes(x = yy_hecho)) +
    geom_line(aes(y = observed, color = "Observado"),  size = 1) +
    geom_line(aes(y = imp_mean,  color = "Imputado JEP-CEV-HRDAG"), size = 1) +
	  geom_line(aes(y = imp_donante,  color = "Imputado por Donante"), size = 1) +
	  geom_line(aes(y = imp_regresion_log,  color = "Imputado por Regresión Log"),
	  					size = 1, linetype = "dashed") +
	  geom_line(aes(y = imp_ml, color = "Imputado por Random Forest"), size = 1, linetype = "dotted") +
	  geom_ribbon(aes(ymin = imp_lo,
                    ymax = imp_hi),
	  						fill = "#1F74B1",
                alpha = 0.2) +
    theme_minimal() +
    theme(axis.text.x = element_text(size = 11, angle = 90),
        axis.title.y = element_text(size = 11),
        axis.ticks.x = element_line(size = 0.1),
        legend.position = "bottom",
        legend.box = "horizontal",
        legend.box.margin = margin(0, 0, 10, 0)) +
    scale_x_continuous(breaks = seq(1980, 2016, 2)) +
		scale_y_continuous(breaks = seq(0, max(mujeres_proyecto_homi$imp_hi,
																				 na.rm = TRUE), by = 250)) +
    theme(legend.position = "bottom") +
    labs(x = "Año",
         y = "Número de víctimas mujeres",
         color = "",
    		 title = "Homicidios") +
    scale_colour_manual(values = c("Imputado JEP-CEV-HRDAG" = "#1F74B1", 
                               "Observado" = "#434343",
    															 "Imputado por Donante" = "red",
    															 "Imputado por Regresión Log" = "#26C33A",
                                 "Imputado por Random Forest" = "#FFC300")) +
  guides(color = guide_legend(nrow = 2, byrow = TRUE))

plot_homi_mujeres_year_imp

ggsave(paste0(output_dir,"/sexo/plot_homi_mujeres_year_imp.jpg"),
			 plot_homi_mujeres_year_imp, width = 7, height = 7)

```

Hombres:

```{r}
hombres_proyecto_homi <- tabla_combinada_homicidio %>%
	  filter(sexo == "HOMBRE",
	  			 yy_hecho >= 1993) %>%
    mutate(observed = as.numeric(observed)) %>% 
    arrange((yy_hecho))

plot_homi_hombres_year_imp <- hombres_proyecto_homi %>%
    mutate(yy_hecho = as.numeric(yy_hecho)) %>% 
	  filter(yy_hecho >= 1998) %>%
    ggplot(aes(x = yy_hecho)) +
    geom_line(aes(y = observed, color = "Observado"),  size = 1) +
    geom_line(aes(y = imp_mean,  color = "Imputado JEP-CEV-HRDAG"), size = 1) +
	  geom_line(aes(y = imp_donante,  color = "Imputado por Donante"), size = 1) +
	  geom_line(aes(y = imp_regresion_log,  color = "Imputado por Regresión Log"),
	  					size = 1, linetype = "dashed") +
	  geom_line(aes(y = imp_ml, color = "Imputado por Random Forest"), size = 1, linetype = "dotted") +
	  geom_ribbon(aes(ymin = imp_lo,
                    ymax = imp_hi),
	  						fill = "#1F74B1",
                alpha = 0.2) +
    theme_minimal() +
    theme(axis.text.x = element_text(size = 11, angle = 90),
        axis.title.y = element_text(size = 11),
        axis.ticks.x = element_line(size = 0.1),
        legend.position = "bottom",
        legend.box = "horizontal",
        legend.box.margin = margin(0, 0, 10, 0)) +
    scale_x_continuous(breaks = seq(1980, 2016, 2)) +
		scale_y_continuous(breaks = seq(0, max(hombres_proyecto_homi$imp_hi,
																				 na.rm = TRUE), by = 2000)) +
    theme(legend.position = "bottom") +
    labs(x = "Año",
         y = "Número de víctimas hombres",
         color = "",
    		 title = "Homicidios") +
    scale_colour_manual(values = c("Imputado JEP-CEV-HRDAG" = "#1F74B1", 
                               "Observado" = "#434343",
    															 "Imputado por Donante" = "red",
    															 "Imputado por Regresión Log" = "#26C33A",
                                 "Imputado por Random Forest" = "#FFC300")) +
  guides(color = guide_legend(nrow = 2, byrow = TRUE))

plot_homi_hombres_year_imp

ggsave(paste0(output_dir,"/sexo/plot_homi_hombres_year_imp.jpg"),
			 plot_homi_hombres_year_imp, width = 7, height = 7)

```

# Secuestro - Sexo

## Comparación de resultados

Mujeres:

```{r}
mujeres_proyecto_secue <- tabla_combinada_secuestro %>%
	  filter(sexo == "MUJER",
	  			 yy_hecho >= 1993) %>%
    mutate(observed = as.numeric(observed)) %>% 
    arrange((yy_hecho))

plot_secue_mujeres_year_imp <- mujeres_proyecto_secue %>%
    mutate(yy_hecho = as.numeric(yy_hecho)) %>% 
	  filter(yy_hecho >= 1998) %>%
    ggplot(aes(x = yy_hecho)) +
    geom_line(aes(y = observed, color = "Observado"),  size = 1) +
    geom_line(aes(y = imp_mean,  color = "Imputado JEP-CEV-HRDAG"), size = 1) +
	  geom_line(aes(y = imp_donante,  color = "Imputado por Donante"), size = 1) +
	  geom_line(aes(y = imp_regresion_log,  color = "Imputado por Regresión Log"),
	  					size = 1, linetype = "dashed") +
	  geom_line(aes(y = imp_ml, color = "Imputado por Random Forest"), size = 1, linetype = "dotted") +
	  geom_ribbon(aes(ymin = imp_lo,
                    ymax = imp_hi),
	  						fill = "#1F74B1",
                alpha = 0.2) +
    theme_minimal() +
    theme(axis.text.x = element_text(size = 11, angle = 90),
        axis.title.y = element_text(size = 11),
        axis.ticks.x = element_line(size = 0.1),
        legend.position = "bottom",
        legend.box = "horizontal",
        legend.box.margin = margin(0, 0, 10, 0)) +
    scale_x_continuous(breaks = seq(1980, 2016, 2)) +
		scale_y_continuous(breaks = seq(0, max(mujeres_proyecto_secue$imp_hi,
																				 na.rm = TRUE), by = 250)) +
    theme(legend.position = "bottom") +
    labs(x = "Año",
         y = "Número de víctimas mujeres",
         color = "",
    		 title = "Secuestros") +
    scale_colour_manual(values = c("Imputado JEP-CEV-HRDAG" = "#1F74B1", 
                               "Observado" = "#434343",
    															 "Imputado por Donante" = "red",
    															 "Imputado por Regresión Log" = "#26C33A",
                                 "Imputado por Random Forest" = "#FFC300")) +
  guides(color = guide_legend(nrow = 2, byrow = TRUE))

plot_secue_mujeres_year_imp

ggsave(paste0(output_dir,"/sexo/plot_secue_mujeres_year_imp.jpg"),
			 plot_secue_mujeres_year_imp, width = 7, height = 7)

```

Hombres:

```{r}
hombres_proyecto_secue <- tabla_combinada_secuestro %>%
	  filter(sexo == "HOMBRE",
	  			 yy_hecho >= 1993) %>%
    mutate(observed = as.numeric(observed)) %>% 
    arrange((yy_hecho))

plot_secue_hombres_year_imp <- hombres_proyecto_secue %>%
    mutate(yy_hecho = as.numeric(yy_hecho)) %>% 
	  filter(yy_hecho >= 1998) %>%
    ggplot(aes(x = yy_hecho)) +
    geom_line(aes(y = observed, color = "Observado"),  size = 1) +
    geom_line(aes(y = imp_mean,  color = "Imputado JEP-CEV-HRDAG"), size = 1) +
	  geom_line(aes(y = imp_donante,  color = "Imputado por Donante"), size = 1) +
	  geom_line(aes(y = imp_regresion_log,  color = "Imputado por Regresión Log"),
	  					size = 1, linetype = "dashed") +
	  geom_line(aes(y = imp_ml, color = "Imputado por Random Forest"), size = 1, linetype = "dotted") +
	  geom_ribbon(aes(ymin = imp_lo,
                    ymax = imp_hi),
	  						fill = "#1F74B1",
                alpha = 0.2) +
    theme_minimal() +
    theme(axis.text.x = element_text(size = 11, angle = 90),
        axis.title.y = element_text(size = 11),
        axis.ticks.x = element_line(size = 0.1),
        legend.position = "bottom",
        legend.box = "horizontal",
        legend.box.margin = margin(0, 0, 10, 0)) +
    scale_x_continuous(breaks = seq(1980, 2016, 2)) +
		scale_y_continuous(breaks = seq(0, max(hombres_proyecto_secue$imp_regresion_log,
																				 na.rm = TRUE), by = 400)) +
    theme(legend.position = "bottom") +
    labs(x = "Año",
         y = "Número de víctimas hombres",
         color = "",
    		 title = "Secuestros") +
    scale_colour_manual(values = c("Imputado JEP-CEV-HRDAG" = "#1F74B1", 
                               "Observado" = "#434343",
    															 "Imputado por Donante" = "red",
    															 "Imputado por Regresión Log" = "#26C33A",
                                 "Imputado por Random Forest" = "#FFC300")) +
  guides(color = guide_legend(nrow = 2, byrow = TRUE))

plot_secue_hombres_year_imp

ggsave(paste0(output_dir,"/sexo/plot_secue_hombres_year_imp.jpg"),
			 plot_secue_hombres_year_imp, width = 7, height = 7)

```

# Reclutamiento - Sexo

## Comparación de resultados

Mujeres:

```{r}
mujeres_proyecto_reclu <- tabla_combinada_reclutamiento %>%
	  filter(sexo == "MUJER",
	  			 yy_hecho >= 1993) %>%
    mutate(observed = as.numeric(observed)) %>% 
    arrange((yy_hecho))

plot_reclu_mujeres_year_imp <- mujeres_proyecto_reclu %>%
    mutate(yy_hecho = as.numeric(yy_hecho)) %>% 
	  filter(yy_hecho >= 1998) %>%
    ggplot(aes(x = yy_hecho)) +
    geom_line(aes(y = observed, color = "Observado"),  size = 1) +
    geom_line(aes(y = imp_mean,  color = "Imputado JEP-CEV-HRDAG"), size = 1) +
	  geom_line(aes(y = imp_donante,  color = "Imputado por Donante"), size = 1) +
	  geom_line(aes(y = imp_regresion_log,  color = "Imputado por Regresión Log"),
	  					size = 1, linetype = "dashed") +
	  geom_line(aes(y = imp_ml, color = "Imputado por Random Forest"), size = 1, linetype = "dotdash") +
	  geom_ribbon(aes(ymin = imp_lo,
                    ymax = imp_hi),
	  						fill = "#1F74B1",
                alpha = 0.2) +
    theme_minimal() +
    theme(axis.text.x = element_text(size = 11, angle = 90),
        axis.title.y = element_text(size = 11),
        axis.ticks.x = element_line(size = 0.1),
        legend.position = "bottom",
        legend.box = "horizontal",
        legend.box.margin = margin(0, 0, 10, 0)) +
    scale_x_continuous(breaks = seq(1980, 2016, 2)) +
		scale_y_continuous(breaks = seq(0, max(mujeres_proyecto_reclu$imp_donante,
																				 na.rm = TRUE), by = 100)) +
    theme(legend.position = "bottom") +
    labs(x = "Año",
         y = "Número de víctimas mujeres",
         color = "",
    		 title = "Reclutamientos") +
    scale_colour_manual(values = c("Imputado JEP-CEV-HRDAG" = "#1F74B1", 
                               "Observado" = "#434343",
    															 "Imputado por Donante" = "red",
    															 "Imputado por Regresión Log" = "#26C33A",
                                 "Imputado por Random Forest" = "#FFC300")) +
  guides(color = guide_legend(nrow = 2, byrow = TRUE))

plot_reclu_mujeres_year_imp

ggsave(paste0(output_dir,"/sexo/plot_reclu_mujeres_year_imp.jpg"),
			 plot_reclu_mujeres_year_imp, width = 7, height = 7)

```

Hombres:

```{r}
hombres_proyecto_reclu <- tabla_combinada_reclutamiento %>%
	  filter(sexo == "HOMBRE",
	  			 yy_hecho >= 1993) %>%
    mutate(observed = as.numeric(observed)) %>% 
    arrange((yy_hecho))

plot_reclu_hombres_year_imp <- hombres_proyecto_reclu %>%
    mutate(yy_hecho = as.numeric(yy_hecho)) %>% 
	  filter(yy_hecho >= 1998) %>%
    ggplot(aes(x = yy_hecho)) +
    geom_line(aes(y = observed, color = "Observado"),  size = 1) +
    geom_line(aes(y = imp_mean,  color = "Imputado JEP-CEV-HRDAG"), size = 1) +
	  geom_line(aes(y = imp_donante,  color = "Imputado por Donante"), size = 1) +
	  geom_line(aes(y = imp_regresion_log,  color = "Imputado por Regresión Log"),
	  					size = 1, linetype = "dashed") +
	  geom_line(aes(y = imp_ml, color = "Imputado por Random Forest"), size = 1, linetype = "dotdash") +
	  geom_ribbon(aes(ymin = imp_lo,
                    ymax = imp_hi),
	  						fill = "#1F74B1",
                alpha = 0.2) +
    theme_minimal() +
    theme(axis.text.x = element_text(size = 11, angle = 90),
        axis.title.y = element_text(size = 11),
        axis.ticks.x = element_line(size = 0.1),
        legend.position = "bottom",
        legend.box = "horizontal",
        legend.box.margin = margin(0, 0, 10, 0)) +
    scale_x_continuous(breaks = seq(1980, 2016, 2)) +
		scale_y_continuous(breaks = seq(0, max(hombres_proyecto_reclu$imp_donante,
																				 na.rm = TRUE), by = 200)) +
    theme(legend.position = "bottom") +
    labs(x = "Año",
         y = "Número de víctimas hombres",
         color = "",
    		 title = "Reclutamientos") +
    scale_colour_manual(values = c("Imputado JEP-CEV-HRDAG" = "#1F74B1", 
                               "Observado" = "#434343",
    															 "Imputado por Donante" = "red",
    															 "Imputado por Regresión Log" = "#26C33A",
                                 "Imputado por Random Forest" = "#FFC300")) +
  guides(color = guide_legend(nrow = 2, byrow = TRUE))

plot_reclu_hombres_year_imp

ggsave(paste0(output_dir,"/sexo/plot_reclu_hombres_year_imp.jpg"),
			 plot_reclu_hombres_year_imp, width = 7, height = 7)

```
